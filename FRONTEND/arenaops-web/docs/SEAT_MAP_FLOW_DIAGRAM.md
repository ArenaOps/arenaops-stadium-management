# Seat Map Booking Flow - Visual Diagrams

## User Journey Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Event Discovery â”‚
â”‚   /events       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User clicks event
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Detail   â”‚
â”‚ /events/[id]    â”‚
â”‚                 â”‚
â”‚ [Book Tickets]  â”‚â—„â”€â”€â”€ "Book Tickets" button
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Navigate
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Seat Selection Page             â”‚
â”‚   /events/[eventId]/book            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   EventSeatMap Component    â”‚   â”‚
â”‚  â”‚  (SVG + SignalR)            â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  ğŸŸ¢ Available               â”‚   â”‚
â”‚  â”‚  ğŸŸ¡ Selected (by you)       â”‚   â”‚
â”‚  â”‚  ğŸ”´ Held/Confirmed (others) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SeatSelectionPanel         â”‚   â”‚
â”‚  â”‚  â€¢ Seat A-12: $50           â”‚   â”‚
â”‚  â”‚  â€¢ Seat B-5: $50            â”‚   â”‚
â”‚  â”‚  Total: $100                â”‚   â”‚
â”‚  â”‚  [Hold Seats]               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User clicks "Hold Seats"
         â”‚ POST /api/core/events/{id}/seats/{seatId}/hold
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Seats Held (2-min timer)        â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   HoldTimer Component       â”‚   â”‚
â”‚  â”‚   â±ï¸  01:45 remaining        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  [Proceed to Payment]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /api/core/bookings
         â”‚ Navigate with bookingId
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Payment Page                  â”‚
â”‚  /bookings/[bookingId]/payment      â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BookingSummary             â”‚   â”‚
â”‚  â”‚  â€¢ Event: Concert           â”‚   â”‚
â”‚  â”‚  â€¢ Seats: A-12, B-5         â”‚   â”‚
â”‚  â”‚  â€¢ Total: $100              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  [Pay Now]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Payment Success
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Confirmation Page               â”‚
â”‚  /bookings/[bookingId]/confirmation â”‚
â”‚                                     â”‚
â”‚  âœ… Booking Confirmed!              â”‚
â”‚  ğŸ« Digital Ticket                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
/events/[eventId]/book (Page)
â”‚
â”œâ”€â”€ EventSeatMap (Smart Component)
â”‚   â”‚
â”‚   â”œâ”€â”€ SeatMapRenderer (Reusable - from /components/seat-map)
â”‚   â”‚   â”œâ”€â”€ SVG Canvas
â”‚   â”‚   â”œâ”€â”€ Section Shapes
â”‚   â”‚   â””â”€â”€ Seat Circles
â”‚   â”‚
â”‚   â”œâ”€â”€ SignalR Connection (Real-time updates)
â”‚   â”‚
â”‚   â””â”€â”€ Seat Selection Logic
â”‚
â”œâ”€â”€ SeatSelectionPanel
â”‚   â”œâ”€â”€ Selected Seats List
â”‚   â”œâ”€â”€ Total Price Display
â”‚   â”œâ”€â”€ [Remove] buttons
â”‚   â”œâ”€â”€ [Clear All] button
â”‚   â””â”€â”€ [Hold Seats] button
â”‚
â”œâ”€â”€ HoldTimer (Conditional - only when seats held)
â”‚   â””â”€â”€ Countdown Display
â”‚
â””â”€â”€ StandingSectionSelector (Conditional - for standing sections)
    â”œâ”€â”€ Quantity Input
    â””â”€â”€ Price Calculation
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EventSeatMap Component                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   API Call  â”‚â”€â”€â”€â–¶â”‚  State Mgmt  â”‚â—€â”€â”€â”€â”‚  SignalR Hub   â”‚  â”‚
â”‚  â”‚  (GET seats)â”‚    â”‚              â”‚    â”‚ (Real-time)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                 â”‚
â”‚                             â–¼                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚  seatMapData    â”‚                        â”‚
â”‚                    â”‚  selectedSeats  â”‚                        â”‚
â”‚                    â”‚  heldSeats      â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                             â”‚                                 â”‚
â”‚                             â–¼                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚ SeatMapRenderer â”‚                        â”‚
â”‚                    â”‚   (Pure UI)     â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Interaction Flow:
1. Click seat â†’ Update selectedSeats state
2. Click "Hold Seats" â†’ POST to API â†’ Update heldSeats state
3. SignalR event â†’ Update seatMapData state â†’ Re-render
```

---

## State Transitions

```
Seat Status State Machine:

    Available
       â”‚
       â”‚ User clicks seat
       â–¼
    Selected (Local State)
       â”‚
       â”‚ User clicks "Hold Seats" â†’ API call
       â–¼
    Held (by you)
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â”‚ Timer expires   â”‚ Payment success
       â”‚                 â”‚
       â–¼                 â–¼
    Available        Confirmed
       â–²                 â”‚
       â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         (Admin refund)


SignalR Updates:
- Other users' actions â†’ Update seat status in real-time
- Cleanup job â†’ Bulk status changes (Held â†’ Available)
```

---

## API Call Sequence

```
Page Load:
  Browser                    Next.js BFF              Backend API
     â”‚                           â”‚                        â”‚
     â”‚  GET /events/[id]/book    â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                           â”‚  GET /api/core/events/{id}/seats
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                           â”‚                        â”‚
     â”‚                           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  EventSeatMapData      â”‚
     â”‚  Render seat map          â”‚                        â”‚


Seat Hold:
  Browser                    Next.js BFF              Backend API
     â”‚                           â”‚                        â”‚
     â”‚  Click "Hold Seats"       â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                           â”‚  POST /api/core/events/{id}/seats/{seatId}/hold
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                           â”‚                        â”‚
     â”‚                           â”‚                        â”‚ (Stored Procedure)
     â”‚                           â”‚                        â”‚ (SignalR Broadcast)
     â”‚                           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  HoldResponse          â”‚
     â”‚  Start timer              â”‚                        â”‚


Real-Time Update (SignalR):
  Browser A                  SignalR Hub              Browser B
     â”‚                           â”‚                        â”‚
     â”‚  Hold seat A-12           â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                           â”‚  SeatStatusChanged     â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                           â”‚  (A-12: Availableâ†’Held)â”‚
     â”‚                           â”‚                        â”‚
     â”‚                           â”‚                        â”‚ Update UI
     â”‚                           â”‚                        â”‚ (A-12 turns red)
```

---

## Reusability Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SeatMapRenderer (Pure Component)               â”‚
â”‚                                                             â”‚
â”‚  Props: config, selectedSeats, onSeatClick, ...             â”‚
â”‚  Responsibility: Render SVG, handle clicks, visual feedback â”‚
â”‚  State: NONE (stateless)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
                              â”‚ Reused by
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
        â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SeatMapDemo   â”‚                      â”‚   EventSeatMap       â”‚
â”‚  /seatmap      â”‚                      â”‚ /events/[id]/book    â”‚
â”‚                â”‚                      â”‚                      â”‚
â”‚  â€¢ Mock data   â”‚                      â”‚  â€¢ API data          â”‚
â”‚  â€¢ No SignalR  â”‚                      â”‚  â€¢ SignalR connected â”‚
â”‚  â€¢ Testing     â”‚                      â”‚  â€¢ Booking logic     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
User Action â†’ API Call â†’ Response

Success Path:
  Hold Seats â†’ API Success â†’ Update State â†’ Show Timer â†’ Enable Payment

Error Paths:

1. Seat Already Held:
   Hold Seats â†’ API Error (409) â†’ Show Toast â†’ Refresh Seat Map

2. Network Error:
   Hold Seats â†’ Network Timeout â†’ Show Retry Button â†’ Log Error

3. Hold Expired During Payment:
   Proceed to Payment â†’ API Error (410) â†’ Redirect to Seat Map â†’ Show Message

4. SignalR Disconnected:
   Connection Lost â†’ Auto-reconnect â†’ Rejoin Event Room â†’ Sync State
```

---

## Mobile Responsive Considerations

```
Desktop Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      â”‚  â”‚  Selection Panel â”‚   â”‚
â”‚  â”‚    Seat Map (SVG)    â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚  â€¢ Seat A-12     â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚  â€¢ Seat B-5      â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚  Total: $100     â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚  [Hold Seats]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mobile Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚   Seat Map (SVG)    â”‚
â”‚   (Scrollable)      â”‚
â”‚                     â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Selection Panel    â”‚
â”‚  (Fixed Bottom)     â”‚
â”‚                     â”‚
â”‚  â€¢ 2 seats selected â”‚
â”‚  Total: $100        â”‚
â”‚  [Hold Seats]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagram Version**: 1.0  
**Companion to**: SEAT_MAP_BOOKING_FLOW_SPEC.md
